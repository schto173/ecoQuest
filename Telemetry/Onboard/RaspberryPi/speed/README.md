# Wheel Speed MQTT Publisher

## Description

This Python script reads wheel speed data, specifically Revolutions Per Minute (RPM) and a timestamp, from a local JSON file (`/tmp/wheel_speed.json`). It then connects to an MQTT broker and publishes this data as a JSON payload to the `speed/data` topic at a configurable rate (e.g., 4 times per second).

This script acts as a bridge, taking speed data generated by another process (e.g., a hardware sensor interface) and making it available over MQTT.

## Features

*   Monitors a specified local JSON file for speed data.
*   Connects to an MQTT broker using provided credentials.
*   Publishes the content of the JSON file to a specific MQTT topic (`speed/data`).
*   Configurable publishing rate (Hz).
*   Handles file access errors (not found, empty file) and JSON decoding errors gracefully.
*   Includes automatic MQTT reconnection logic.
*   Uses low-overhead QoS 0 for publishing high-frequency data.

## Dependencies

### Hardware

*   A system running Python 3 (e.g., Raspberry Pi).
*   Network connection (WiFi or Ethernet).
*   **Crucially:** Another process must be running that generates and frequently updates the `/tmp/wheel_speed.json` file with the correct format.

### Software

*   Python 3
*   **Required Python Libraries:** Install using pip:
    ```bash
    pip install paho-mqtt
    ```

## Configuration

Parameters are configured directly within the `speed_publisher.py` script:

*   **MQTT Broker Details:**
    *   `MQTT_BROKER`: Address of your MQTT broker.
    *   `MQTT_PORT`: Port of your MQTT broker.
    *   `MQTT_USER`: MQTT username.
    *   `MQTT_PASSWORD`: MQTT password.
*   **MQTT Topic:**
    *   `MQTT_TOPIC_SPEED`: The topic where speed data will be published (default: `"speed/data"`).
*   **Input File:**
    *   `WHEEL_SPEED_FILE`: The full path to the JSON file containing the speed data (default: `'/tmp/wheel_speed.json'`).
*   **Publish Rate:**
    *   `PUBLISH_RATE_HZ`: The target number of times per second to read the file and publish to MQTT (default: `4`).

## Input File Format

The script expects the file specified by `WHEEL_SPEED_FILE` (`/tmp/wheel_speed.json` by default) to contain a valid JSON object with at least the following keys:

*   `rpm`: (float or int) The measured revolutions per minute.
*   `timestamp`: (float or int) A Unix timestamp indicating when the RPM was measured.

**Example `/tmp/wheel_speed.json` content:**

```json
{"rpm": 150.0, "timestamp": 1678886402.123}